function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}var r=require("react-admin"),t=e(require("firebase")),n=e(require("deep-assign")),u={admin:{path:"/users/",validate:function(){return!0}},keys:{permissions:"user",token:"firebase"},handleAuthStateChange:function(e,r){return new Promise(function(n,u){var i,a;return e?(i=r.admin.path+e.uid,t.database().ref(i).once("value").then(function(i){try{if(void 0!==(a=i.val())&&null!==a&&r.admin.validate(a)){var o;o=e.getIdToken();var s={profile:a,firebaseToken:o};return localStorage.setItem(r.keys.token,o),localStorage.setItem(r.keys.permissions,JSON.stringify(a)),n(s)}return t.auth().signOut(),localStorage.removeItem(r.keys.token),n(Promise.reject(new Error("Oops! You don't seem to be a authorized user")))}catch(e){return u(e)}}.bind(this),u)):(localStorage.removeItem(r.keys.token),o.call(this));function o(){return n()}})}};exports.FirebaseAuthProvider=function(e){void 0===e&&(e={}),e=n({},u,e);var i=function(){return new Promise(function(e){t.auth().onAuthStateChanged(e)})};return function(n,u){return new Promise(function(a,o){if(n===r.AUTH_LOGOUT)return e.handleAuthStateChange(null,e).then(function(e){try{return a(t.auth().signOut())}catch(e){return o(e)}},o);if(t.auth().currentUser)return t.auth().currentUser.reload().then(function(e){try{return s.call(this)}catch(e){return o(e)}}.bind(this),o);function s(){var s,c;if(n===r.AUTH_CHECK)return i().then(function(e){try{return t.auth().currentUser?a(!0):a(Promise.reject(new Error("Oops! You don't seem to be signed in.")))}catch(e){return o(e)}},o);if(n===r.AUTH_LOGIN){var h,l,f;if(h=(s=u).username,l=s.password,!(f=t.auth().currentUser)){var d=function(){try{return g.call(this)}catch(e){return o(e)}}.bind(this),m=function(e){try{return a(Promise.reject(e))}catch(e){return o(e)}};try{return t.auth().signInWithEmailAndPassword(h,l).then(function(e){try{return f=e,d()}catch(e){return m(e)}},m)}catch(e){m(e)}}function g(){return a(e.handleAuthStateChange(f,e))}return g.call(this)}return n===r.AUTH_GET_PERMISSIONS?(c=localStorage.getItem(e.keys.permissions),a(c?Promise.resolve(JSON.parse(c)):Promise.reject(new Error("Could not get permissions")))):a(!1)}return s.call(this)})}};
//# sourceMappingURL=ra-auth-firebase.js.map
